<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../px-colors-design/colors.html"/>
<link rel="import" href="px-vis-behavior-common.html"/>
<link rel="import" href="px-vis-behavior-register.html"/>

<!--
Element providing a display and interaction space for series in your chart.

It can be either vertical on the side of the chart or horizonal above or below your chart. It displays a colored bar matching the series color and the series name. When you hover over the chart, the chart sends data to the register via the bound "tooltipData" property. These data values are then displayed in the register.

You can turn series on the chart off by clicking on that series in the register.

##### Usage

    <px-vis-register-item
        item="[[item]]"
        complete-series-config="[[completeSeriesConfig]]"
        type="[[type]]"
        x-axis-type="[[xAxisType]]"
        y-axis-type="[[yAxisType]]">
    </px-vis-register-item>


##### Sending Data to the Register
tooltipData is in the form:

    {
        'time': d3TimeStamp,
        'series': [
            {'name':'seriesName0','value': seriesVal0 },
            {'name':'seriesName1','value': seriesVal1 }
        ]
    }

When not hovering on a chart, the tooltipData should still have the series names in order for them to still appear in the register. IE:

    {
        'time': null,
        'series': [
            {'name':'seriesName0','value': null },
            {'name':'seriesName1','value': null }
        ]
    }

##### Reporting Data from the Register
The component returns an object via mutedSeries which the chart can take and react to:

    {
        'seriesId1':true,
        'seriesId2':false,
    }

##### Time, number, and name formatting
Formatting for the timestamps,the data values, and the series names can be controlled via a series of properties. Please see the properties for configuration details.

@element px-vis-register
@blurb Element providing a display and interaction space for series in your chart.
@homepage index.html
@demo demo.html
-->

<link rel="import" href="css/px-vis-register-styles.html">

<dom-module id="px-vis-register-item">

  <template>
    <style include="px-vis-register-styles"></style>
    <style include="px-theme-styles"></style>

    <span
      class$="[[_itemMutedToStart]]"
      name$="R{{item.name}}"
      id="regItem"
      on-click="_seriesClicked">
      <span
        class="seriesMarker"
        style$="background-color:[[_itemColor]]"
        name$="R{{item.name}}">&nbsp;</span>
      <span class$="[[_wrapperClass]]">
        <div
          class="seriesName"
          name$="R{{item.name}}">
          {{_truncatedName}}&nbsp;
          <template is="dom-if" if="[[_didTruncate]]">
            <px-tooltip delay="500">[[_configName]]</px-tooltip>
          </template>
        </div>
        <!-- Display serie data differently depending on x and y axis types -->
        <div class="seriesData" name$="R{{item.name}}">
          <!-- if x axis is number format and show it -->
          <template is="dom-if" if="{{_isOfType(xAxisType, 'linear')}}">
            <template is="dom-if" if="{{_returnVal(item, 'x')}}">
              <numbro-element
                value="[[_itemX]]"
                format="[[numberFormat]]"
                culture="[[numberFormatCulture]]"
                currency$="[[numberFormatIsCurrency]]"
                default-currency-format="[[numberFormatCurrency]]"
                zero-format="[[numberFormatZero]]">
              </numbro-element>
              <template is="dom-if" if="[[_itemX]]">
                {{_xUnit}}
              </template>
              <template is="dom-if" if="[[_itemX]]">
                &nbsp;/&nbsp
              </template>
            </template>
          </template>
          <!-- if x axis is ordinal just display it -->
          <template is="dom-if" if="{{_isOfType(xAxisType, 'ordinal')}}">
            x ordinal
            <span>[[_itemX]]</span>
            <template is="dom-if" if="[[_itemX]]">
              {{_xUnit}}
            </template>
            <template is="dom-if" if="[[_itemX]]">
              &nbsp;/&nbsp
            </template>
          </template>
          <!-- if x axis is time don't display it -->
          <!-- if y axis is number format and show it -->
            <template is="dom-if" if="{{_isOfType(yAxisType, 'linear')}}">
              <template is="dom-if" if="{{_returnVal(item, 'y')}}">
                <numbro-element
                  value="[[_itemY]]"
                  format="[[numberFormat]]"
                  culture="[[numberFormatCulture]]"
                  currency$="[[numberFormatIsCurrency]]"
                  default-currency-format="[[numberFormatCurrency]]"
                  zero-format="[[numberFormatZero]]">
                </numbro-element>
              </template>
            </template>
            <!-- if y axis is ordinal just display it -->
            <template is="dom-if" if="{{_isOfType(yAxisType, 'ordinal')}}">
              <span>[[_itemY]]</span>
            </template>
            <template is="dom-if" if="[[_itemY]]">
              {{_yUnit}}
            </template>
          </div>
        </span>
      </span>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'px-vis-register-item',

    behaviors: [
      PxVisBehavior.formatting,
      PxVisBehavior.completeSeriesConfig,
      PxVisBehavior.truncating,
      PxVisBehavior.mutedSeries,
      PxVisBehavior.axisTypes,
      PxVisBehaviorRegister.register,
      PxVisBehaviorRegister.itemShared,
      PxVisBehaviorRegister.nonPieItem,
      commonColors
    ],
    properties: {

    },
    observers: [
      '_toggleSeries(item,mutedSeries.*)'
    ],

  });
</script>
